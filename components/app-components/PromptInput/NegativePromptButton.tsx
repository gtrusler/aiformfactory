"use client";

import { Popover, Transition } from "@headlessui/react";
import { Fragment, useState } from "react";
import { usePopper } from "react-popper";
import classNames from "classnames";
const NegativePromptButton = ({
  negativePrompt,
  onNegativePrompt,
}: {
  negativePrompt: string;
  onNegativePrompt: (value: string) => void;
}) => {
  const [referenceElement, setReferenceElement] = useState();
  const [popperElement, setPopperElement] = useState();
  const { styles, attributes } = usePopper(referenceElement, popperElement, {
    placement: "top-start",
    strategy: "fixed",
  });

  return (
    <Popover className="relative">
      {({ open, close }) => (
        <>
          <Popover.Button
            ref={setReferenceElement as any}
            className={classNames(
              "group p-[7px] w-11 h-11 justify-center items-center inline-flex rounded-lg ring-1 ring-[#EBF0F3] hover:bg-opacity-5 hover:bg-content-brand",
              {
                "bg-opacity-5 bg-content-brand": open,
              }
            )}
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
              className={classNames("w-5 h-5 group-hover:fill-content-brand", {
                "fill-content-brand": open,
              })}
            >
              <g opacity="0.5">
                <path
                  opacity="0.2"
                  d="M10 6.25C10 6.62084 9.89003 6.98335 9.68401 7.29169C9.47798 7.60004 9.18514 7.84036 8.84253 7.98227C8.49992 8.12419 8.12292 8.16132 7.75921 8.08897C7.39549 8.01663 7.0614 7.83805 6.79918 7.57583C6.53695 7.3136 6.35838 6.97951 6.28603 6.61579C6.21368 6.25208 6.25081 5.87508 6.39273 5.53247C6.53464 5.18986 6.77496 4.89702 7.08331 4.69099C7.39165 4.48497 7.75416 4.375 8.125 4.375C8.62228 4.375 9.0992 4.57254 9.45083 4.92417C9.80246 5.27581 10 5.75272 10 6.25ZM13.125 11.875C12.7542 11.875 12.3916 11.985 12.0833 12.191C11.775 12.397 11.5346 12.6899 11.3927 13.0325C11.2508 13.3751 11.2137 13.7521 11.286 14.1158C11.3584 14.4795 11.537 14.8136 11.7992 15.0758C12.0614 15.338 12.3955 15.5166 12.7592 15.589C13.1229 15.6613 13.4999 15.6242 13.8425 15.4823C14.1851 15.3404 14.478 15.1 14.684 14.7917C14.89 14.4834 15 14.1208 15 13.75C15 13.2527 14.8025 12.7758 14.4508 12.4242C14.0992 12.0725 13.6223 11.875 13.125 11.875Z"
                />
                <path d="M3.125 6.87502H5.70312C5.84081 7.41278 6.15356 7.88942 6.59207 8.22979C7.03057 8.57017 7.56989 8.75492 8.125 8.75492C8.68011 8.75492 9.21943 8.57017 9.65793 8.22979C10.0964 7.88942 10.4092 7.41278 10.5469 6.87502H16.875C17.0408 6.87502 17.1997 6.80917 17.3169 6.69196C17.4342 6.57475 17.5 6.41578 17.5 6.25002C17.5 6.08426 17.4342 5.92529 17.3169 5.80808C17.1997 5.69087 17.0408 5.62502 16.875 5.62502H10.5469C10.4092 5.08726 10.0964 4.61062 9.65793 4.27024C9.21943 3.92987 8.68011 3.74512 8.125 3.74512C7.56989 3.74512 7.03057 3.92987 6.59207 4.27024C6.15356 4.61062 5.84081 5.08726 5.70312 5.62502H3.125C2.95924 5.62502 2.80027 5.69087 2.68306 5.80808C2.56585 5.92529 2.5 6.08426 2.5 6.25002C2.5 6.41578 2.56585 6.57475 2.68306 6.69196C2.80027 6.80917 2.95924 6.87502 3.125 6.87502ZM8.125 5.00002C8.37223 5.00002 8.6139 5.07333 8.81946 5.21068C9.02502 5.34803 9.18524 5.54326 9.27985 5.77167C9.37446 6.00007 9.39921 6.25141 9.35098 6.49388C9.30275 6.73636 9.1837 6.95909 9.00888 7.1339C8.83407 7.30872 8.61134 7.42777 8.36886 7.476C8.12639 7.52423 7.87505 7.49948 7.64665 7.40487C7.41824 7.31026 7.22301 7.15004 7.08566 6.94448C6.94831 6.73892 6.875 6.49725 6.875 6.25002C6.875 5.9185 7.0067 5.60056 7.24112 5.36614C7.47554 5.13172 7.79348 5.00002 8.125 5.00002ZM16.875 13.125H15.5469C15.4092 12.5873 15.0964 12.1106 14.6579 11.7702C14.2194 11.4299 13.6801 11.2451 13.125 11.2451C12.5699 11.2451 12.0306 11.4299 11.5921 11.7702C11.1536 12.1106 10.8408 12.5873 10.7031 13.125H3.125C2.95924 13.125 2.80027 13.1909 2.68306 13.3081C2.56585 13.4253 2.5 13.5843 2.5 13.75C2.5 13.9158 2.56585 14.0748 2.68306 14.192C2.80027 14.3092 2.95924 14.375 3.125 14.375H10.7031C10.8408 14.9128 11.1536 15.3894 11.5921 15.7298C12.0306 16.0702 12.5699 16.2549 13.125 16.2549C13.6801 16.2549 14.2194 16.0702 14.6579 15.7298C15.0964 15.3894 15.4092 14.9128 15.5469 14.375H16.875C17.0408 14.375 17.1997 14.3092 17.3169 14.192C17.4342 14.0748 17.5 13.9158 17.5 13.75C17.5 13.5843 17.4342 13.4253 17.3169 13.3081C17.1997 13.1909 17.0408 13.125 16.875 13.125ZM13.125 15C12.8778 15 12.6361 14.9267 12.4305 14.7894C12.225 14.652 12.0648 14.4568 11.9701 14.2284C11.8755 14 11.8508 13.7486 11.899 13.5062C11.9472 13.2637 12.0663 13.041 12.2411 12.8661C12.4159 12.6913 12.6387 12.5723 12.8811 12.524C13.1236 12.4758 13.3749 12.5006 13.6034 12.5952C13.8318 12.6898 14.027 12.85 14.1643 13.0556C14.3017 13.2611 14.375 13.5028 14.375 13.75C14.375 14.0815 14.2433 14.3995 14.0089 14.6339C13.7745 14.8683 13.4565 15 13.125 15Z" />
              </g>
            </svg>
          </Popover.Button>
          <Transition
            as={Fragment}
            enter="transition ease-out duration-200"
            enterFrom="opacity-0 translate-y-1"
            enterTo="opacity-100 translate-y-0"
            leave="transition ease-in duration-150"
            leaveFrom="opacity-100 translate-y-0"
            leaveTo="opacity-0 translate-y-1"
          >
            <Popover.Panel
              ref={setPopperElement as any}
              style={styles.popper}
              {...attributes.popper}
              className="absolute z-10 flex flex-col-reverse h-40 w-80"
            >
              <div className="w-full h-full mb-2 overflow-hidden shadow-lg rounded-xl">
                <div className="flex flex-col w-full h-full gap-2 p-3 pt-2 bg-white">
                  <div className="flex items-center justify-between">
                    <span className="text-xs font-bold">Negative Prompt</span>
                    <button onClick={() => close()}>
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M12.8537 12.1463C12.9002 12.1927 12.937 12.2479 12.9622 12.3086C12.9873 12.3693 13.0003 12.4343 13.0003 12.5C13.0003 12.5657 12.9873 12.6308 12.9622 12.6915C12.937 12.7522 12.9002 12.8073 12.8537 12.8538C12.8073 12.9002 12.7521 12.9371 12.6914 12.9622C12.6307 12.9874 12.5657 13.0003 12.5 13.0003C12.4343 13.0003 12.3692 12.9874 12.3085 12.9622C12.2478 12.9371 12.1927 12.9002 12.1462 12.8538L7.99997 8.70691L3.85372 12.8538C3.7599 12.9476 3.63265 13.0003 3.49997 13.0003C3.36729 13.0003 3.24004 12.9476 3.14622 12.8538C3.0524 12.76 2.99969 12.6327 2.99969 12.5C2.99969 12.3674 3.0524 12.2401 3.14622 12.1463L7.2931 8.00003L3.14622 3.85378C3.0524 3.75996 2.99969 3.63272 2.99969 3.50003C2.99969 3.36735 3.0524 3.2401 3.14622 3.14628C3.24004 3.05246 3.36729 2.99976 3.49997 2.99976C3.63265 2.99976 3.7599 3.05246 3.85372 3.14628L7.99997 7.29316L12.1462 3.14628C12.24 3.05246 12.3673 2.99976 12.5 2.99976C12.6327 2.99976 12.7599 3.05246 12.8537 3.14628C12.9475 3.2401 13.0003 3.36735 13.0003 3.50003C13.0003 3.63272 12.9475 3.75996 12.8537 3.85378L8.70685 8.00003L12.8537 12.1463Z"
                          fill="#343330"
                        />
                      </svg>
                    </button>
                  </div>
                  <textarea
                    className="pl-2 pt-4 gap-0.5 rounded-lg w-full h-28 ring-1 ring-border-disabled text-xs resize-none !outline-none focus:ring-2 focus:ring-border-brand-alt"
                    placeholder="Enter things you donâ€™t want to see in your generation."
                    value={negativePrompt}
                    onChange={(e) => onNegativePrompt(e.target.value)}
                  />
                </div>
              </div>
            </Popover.Panel>
          </Transition>
        </>
      )}
    </Popover>
  );
};

export default NegativePromptButton;
